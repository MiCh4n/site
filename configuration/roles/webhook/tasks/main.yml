---
- name: Install webhook
  apt:
    name: webhook
    state: latest

- name: Read secret
  shell:
    cmd: cat /var/webhook_secret
  register: secret_tmp

- set_fact:
    secret={{ secret_tmp.stdout }}

- name: Generate hooks.json
  template:
    src: hooks.json
    dest: /etc/webhook/hooks.json
    owner: webhook
    group: webhook
    mode: '0644'

- name: Copy webhook.service
  copy:
    src: webhook.service
    dest: /etc/systemd/system/webhook.service
    owner: root
    group: root
    mode: '0644'
  notify: restart webhook


---
- name: Install f2b
  apt:
    name: fail2ban
    state: latest

- name: Configure f2b
  copy:
    src: fail2ban.local
    dest: /etc/fail2ban/fail2ban.local
    owner: root
    group: root
    mode: '0644'
    backup: yes
  notify: restart f2b

- name: Install unattended-upgrades
  apt:
    name: unattended-upgrades
    state: latest

- name: Configure unattended-upgrades
  copy:
    src: "{{ item }}"
    dest: /etc/apt/apt.conf.d/{{ item }}
    owner: root
    group: root
    mode: '0644'
  with_items:
    - 50unattended-upgrades
    - 20auto-upgrades

- name: Install ufw
  apt:
    name: ufw
    state: latest

- name: Configure UFW
  shell:
    cmd: "{{ item }}"
  with_items:
    - ufw allow proto tcp from 0.0.0.0/0 to 0.0.0.0/0 port 22
    - ufw allow proto tcp from 0.0.0.0/0 to 0.0.0.0/0 port 10382
    - ufw allow proto tcp from any to ::/0 port 80
    - ufw logging on

    #  ufw allow proto tcp from 0.0.0.0/0 to any port 22